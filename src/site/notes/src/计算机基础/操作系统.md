---
{"dg-publish":true,"dg-permalink":"操作系统","permalink":"/操作系统/"}
---


#操作系统

## 进程和线程的区别？

- 进程：
	- 资源分配的基本单位
	- 是**正在运行的程序**的抽象
- 线程：
	- 系统调度的最小单元
	- 一个进程中可以有多个线程，它们**共享进程资源**
- 区别：
	1. 线程不拥有资源
	2. 线程的切换不会引起进程切换
	3. 进程系统开销大于线程
	4. 进程通信需要借助 IPC

## 线程都有哪些实现？

1. **轻量级**进程（1：1）
	- 一个轻量级进程（LWP）对应一个内核线程
	- 线程调度会系统调用，**效率低**
2. **用户**线程（1：N，Java 采用的模式）
	- 多个用户线程（User Thread）对应一个内核线程
	- 优点：切换不需要系统调用，**效率很高**
	- 缺点：实现**复杂**、难度大
3. **混合**线程（N：M）
	- 轻量级进程与用户线程的混合
4. 轻量级线程
	- 协程

## 什么情况下会使用多进程？

1. 多进程可以实现**资源隔离**，不需要考虑太多内存锁之类
2. 但无法和多线程一样，共享内存数据

## 如何设计一个协程？

1. 区别
	- 线程/进程是内核进行调度，有 CPU 时间片概念，进行**抢占式**调度
	- 协程对内核透明，需要由用户程序自己控制，进行**协作式**调度（主动转让控制权）
2. 调度策略
	- 1:1 调度（1 个协程绑定 1 个线程）
		- 优点：实现**简单**，协程的调度都由 CPU 完成
		- 缺点：上下文切换等同于线程切换，比较慢
	- N:1 调度（N 个协程绑定 1 个线程）
		- 优点：在用户态就可以完成切换，**轻量快速**
		- 缺点：某协程阻塞，会造成线程阻塞，从而本线程的其他协程也会被阻塞
	- M:N 调度（M 个协程绑定 N 个线程）
		- 优点：克服上面两个的缺点
		- 缺点：实现复杂

## 进程通信有几种方式？

1. 管道和命名管道：管道可用于具有**亲缘关系**的父子进程间的通信
2. 信号：通知接收线程某个事件已经发生
3. 消息队列：消息的链接表，线程分别从队列中写入和读取消息
4. 共享内存：多个线程同时访问**一块内存空间**，但需要同步操作，如互斥量
5. 信号量
6. 套接字：可用于网络中**不同机器**之间的进程间通信

## 用户态和内核态的区别？

1. 用户态：
	- 正在运行非可信应用程序
	- 特点：
		- **无法**执行特权指令
		- 只能访问当前程序所在的地址空间
2. 内核态：
	- 可以执行**全部**机器指令
	- 可访问**所有**内存单元和系统资源，并具有改变处理器状态能力
3. 用户态 -> 内核态
	- **系统调用**：例如 fork 函数；
	- **异常**：如缺页异常；
	- 外围设备的**中断**

## 零拷贝的原理？

1. [零拷贝](obsidian://open?vault=%E7%AC%94%E8%AE%B0&file=src%2Funarchived%2F%E9%9B%B6%E6%8B%B7%E8%B4%9D)的实现方式有两种
	- mmap 代替 read
		- 把内核缓冲区数据映射到用户态，减少拷贝
		- 仍需 **2 次**系统调用（mmap、write）
		- 仍需 CPU 的参与，将数据拷贝到 socket 缓冲区
	- sendfile
		- 只需 **1 次**系统调用
		- 直接将数据从内核态复制到网卡缓冲区，**无需** CPU 参与（由 **DMA** 来完成）
2. 原理
	- 依靠底层硬件 **DMA 技术**
3. 优点
	- 提高文件**传输的性能**（至少一倍以上）
		- 减少拷贝
		- 减少上下文切换（系统调用）
	- 让 CPU 不参与文件数据的传输，全程由 DMA 来完成

## 什么是页缓存？

1. 原理
	- 以页大小（4KB）为单位，将文件划分为多数据块
	- 当用户对文件的每个数据块操作时，实际上是与**绑定的内存页**进行读写
2. 作用
	- 降低**磁盘读写和内存读写**的速度差异