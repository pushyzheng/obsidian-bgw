---
{"dg-publish":true,"dg-permalink":"分布式限流","permalink":"/分布式限流/"}
---


#分布式 

## 怎么理解限流？

一共有三个维度：
1. **资源**：针对什么资源进行限流：接口、连接
2. **阈值**：流量峰值达到多少后，进行限制？
3. **触发限流后的行为**：熔断、降级

## 分布式限流都有哪些实现方案？

1. ==计数器==
	- 实现原理：在固定时间窗口内，限制最大请求次数
	- 缺陷：
		- **临界点**问题：在限流器（max=N）重置的瞬时，可以发起 2N 次请求
		- **突刺**问题：在前一段用完所有资源，后一段无资源可用
2. ==滑动窗口==
	- 实现原理：计数器改进方案，将窗口**细化**，并进行滑动
3. ==漏桶算法==
	- 实现原理：
		- 请求大量进入漏桶，超过最大容量丢弃
		- 漏桶以**固定速率**放行请求
	- 优点：漏桶出口速率固定，可以**避免突刺**问题
	- 缺陷：应对突发流量时，会太「平滑」
4. ==令牌桶算法==
	- 实现原理：
		- 往令牌桶以固定速率放令牌，满则丢弃
		- 请求线程尝试获取令牌，成功则放行，否则被限流
	- 优点：
		- 可以支持突发流量

## 漏桶算法和令牌桶算法的区别？

| Name       | 漏桶算法 | 令牌桶算法 |
| ---------- | -------- | ---------- |
| 桶的存放的 | 请求     | 令牌       |
| 入速率     | 不固定   | **固定**       |
| 出速率     | **固定**     | 不固定     |

## 为什么令牌桶可以解决突发流量呢？而漏桶算法不行？

1. 对于令牌桶：
	- 有桶深的概念，在流量比较低的情况下**会积攒一定的令牌**，当突发流量来时，可以使用这部分令牌
	- 流出速率是不固定的，取决与流量的多少
2. 而对于漏桶算法：
	- 流出速率最大就等于流入速率

## 限流的框架都有？它们分别使用什么限流算法？

1. 令牌桶
	- Guava RateLimiter
	- Resilience4j RateLimiter
2. 滑动窗口
	- Sentinel
3. 计数器
	- 自己通过 Redis 的 incr + expire 来实现