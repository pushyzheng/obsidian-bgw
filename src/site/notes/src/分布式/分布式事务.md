---
{"dg-publish":true,"dg-permalink":"分布式事务","permalink":"/分布式事务/"}
---


## 有哪些分布式事务的实现？

1. 强事务
	- [XA](obsidian://open?vault=%E7%AC%94%E8%AE%B0&file=src%2Funarchived%2FXA)
		- 由分布式事务管理器来统筹所有结点的本地事务
		- 缺点：
			1. **同步阻塞**：事务执行期间所有结点都阻塞
			2. **单点故障**：对分布式事务管理器强依赖
	- [TCC](obsidian://open?vault=%E7%AC%94%E8%AE%B0&file=src%2Funarchived%2FTCC)
		- 将原先业务拆分为三个执行单元：
			1. Try：尝试执行，预留资源
			2. Commit：真正执行业务逻辑
			3. Cancel：回滚操作
		- 缺点：**编程复杂**，对业务的改造和侵入性大
2. 柔性事务
	- 本地消息
		- 将业务逻辑和插入本地消息表在**同一个本地事务**（如 MySQL）完成
		- 并**定时轮询**本地消息表状态进行补偿
	- 可靠消息最终一致性
		- 基于可靠的 MQ 来实现， 如 Rocket MQ
		- 半消息机制：
			1. 半消息**不会立即投递**，而是会等待 Producer 二次确认（commit）后才会投递给 Consumer
			2. Consumer 在消费消息时如果失败，会进行**补偿重试**
			3. **反查**：如果二次确认超时，Broker 会调用 Producer 反查接口确认事务的状态
		- 优点：
			- 将大事务拆分为小事务，一个系统的失败**不会导致整体流程回滚**，只需要针对失败系统做数据修订即可
			- 实现相对简单
