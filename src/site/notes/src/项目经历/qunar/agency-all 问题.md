---
{"dg-publish":true,"dg-permalink":"agency-all 问题","permalink":"/agency-all 问题/"}
---


#项目 

## 该项目的难点？

1. 技术上
	- 系统负载大
		- 增加中间层后，要承担之前上游所有流量，在技术选型和方案设计上都需要花时间考量
		- 在上线前要做好预估（机器个数、线程池参数、Redis 集群大小），以及流量切换的观测
	- 首次接触 *Reactor* 响应式编程，代码编写的开发的难度提升
2. 业务上项目进度上
	- 由我**主要负责**这个项目的前期的设计，以及核心模块的开发，整体项目进度的推进，之前缺少这方面的经验
	- 方案讨论、接口改造需要多方的配合，协调和沟通

## 进订失败率的提高和提升间夜有什么关系？

定义：
- 进订失败率：客人尝试预订但最终未能成功完成预订的比例
- 间夜：酒店行业的基本计量单位，指一个房间住一晚

负相关关系 - 进订失败率的提高通常会导致间夜数量的减少：
- 直接损失：每一次失败的预订都代表潜在间夜收入的流失
- 客户流失：预订体验不佳可能导致客户转向竞争对手

因此降低进订失败率，能提高用户预定房型的成功率，从而提高订单的产量

## 项目的展望

1. 加强系统的**稳定性**和健壮性，细粒化监控和报警设置
2. 实现**主动检查**报价缓存的有效性，以及随机抽查的方式，进一步提高价格的新鲜度

## 稳定性会从哪方面去做建设？（如何保证系统的高可用？）

1. 自动防御
	- 对上游**限流**：保护自身系统
	- 对下游限流：保护下游代理商系统
	- [[src/分布式/高并发#熔断、降级、限流分别是什么？\|熔断降级]]：
		- 调用远程 HTTP 超时和异常情况，及时节省资源
		- 支持以**代理商维度**来动态配置，和手动开关断路器
2. 可观测性
	- 基础维度：机器内存、CPU、I/O 指标、JVM 等
	- 应用维度：**流量**和**耗时**的监控
3. 资源隔离
	- **环境隔离**：区别 list 页报价和 order 页报价
4. 预案
	- 压测：上线前预估单机最高流量
	- Redis 集群挂掉：直接远程调用代理商实时接口，并限流，保证部分酒店的报价是可用的

## Spring Reactor 是如何选型的？

1. 对 Spring 生态友好
	- Spring MVC 本身
	- Spring Cloud 如 Resilience4J 组件整合
	- Reactor 是 Spring 整个生态系统的基础，特别是 Spring 5 （Spring Web Reactive，Web Flux）
2. 至少要求 Java 8
	- 内部利用了很多新版 Java8+ 的特性
	- 方便转换为：CompletableFuture、Stream、Optional 对象