---
{"dg-publish":true,"dg-permalink":"MySQL 基础","permalink":"/MySQL 基础/"}
---


#数据库 #MySQL 

## MySQL 的服务架构

![Pasted image 20250723192609.png](/img/user/attachments/images/Pasted%20image%2020250723192609.png)

1. ==连接层==
	- 负责处理**客户端连接**请求
	- 监听网络端口（3306），等待客户端连接
2. ==服务层==
	- 是MySQL服务器的核心，做 SQL 语句的**解析与执行**管理
	- SQL接口、解析器、预处理器和校验器、优化器、执行器等
3. ==存储引擎层==
	- 提供底层的**数据存储和检索**
	- 由各个[[src/数据库/MySQL 基础#MySQL 有哪些引擎？有什么区别？\|存储引擎]]来实现具体的数据结构、索引、事务处理机制等
4. ==数据存储层==
	- 由操作系统的**文件系统管理**物理数据文件，存储具体的数据内容

## MySQL 中的 varchar 和 char 有什么区别？

- char 是一个**定长**字段，不论实际存储多少，都占用申请的大小
- varchar 是**变长**的，占用的空间为实际字符长度 +1

## drop、delete 与truncate 的区别

|          | 类型 | 删除表？ | 删除数据？ | 可回滚？ | 速度 |
| -------- | ---- | -------- | ---------- | -------- | ---- |
| Delete   | DML  | N        | Y          | Y        | 慢   |
| Drop     | DDL  | Y        | Y          | N        | 最快 |
| Truncate | DDL  | N        | Y          | N        | 快   |

## MySQL 执行一次查询的过程？

![Pasted image 20220904214853.png|500](/img/user/attachments/images/Pasted%20image%2020220904214853.png)

1. ==连接建立与权限验证==
	- 校验用户名和密码是否合法
	- 判断用户是否有执行该 SQL 的权限
2. ==查询缓存检查==（MySQL 8.0之前版本）
	- 查询是否有已经缓存该查询结果的key-value
	- 8.0+ 版本**已移除**查询缓存功能
3. ==SQL语法分析==
	- 对SQL语句进行词法分析和语法分析，确认 SQL **结构和语法正确性**
	- 检查表和字段是否存在
4. ==优化阶段==
	- 优化器基于解析树进行优化，生成执行计划
	- 根据表的索引等选择**最优执行路径**（选择合适的索引或访问方法）
5. ==执行器执行==
	- MySQL调用存储引擎接口从数据文件读取数据
	- 执行过滤、排序、聚合等操作
6. ==返回结果==

## 内连接、左连接、右连接含义和作用?

1. 左连接：返回包括**左表中的所有记录**和右表中连接字段相等的记录
2. 右连接：返回包括**右表中的所有记录**和左表中连接字段相等的记录
3. 内连接：**只返回**两个表中连接字段相等的行
4. 全外连接：返回左右表中所有的记录和左右表中连接字段相等的记录

## MySQL 有哪些引擎？有什么区别？

| 功能         | MyISAM | Memory | InnoDB(默认) |
| ------------ | ------ | ------ | ------------ |
| 存储限制     | 256TB  | RAM    | 64TB         |
| 事务         | No     | No     | Yes          |
| 外键         | No     | No     | Yes          |
| 行锁         | No     | No     | Yes          |
| 崩溃修复能力 | No     | No     | Yes          |
| 速度         | 较快   | 快     | 慢           |
| 聚集索引     | No     | No     | Yes          | 

*MyISAM* （[maiˈzæm]）和 *InnoDB* 极致差别：
1. ==文件存储形式==
	- MyISAM：分为 MDY（数据）、MYI（索引）、sdi（表的元数据）存储；B+ 树叶子结点存储的不是真实的数据，而是文件中的地址
	- InnoDB：**不区分数据和索引**，都存储在一个文件中
2. ==表的行数获取==
	- MyISAM：将行数记录在了**表头**中，查询非常迅速
	- InnoDB：需要进行**全盘扫描**，效率比较低（受事务隔离机制的原因）

## MySQL 的各种引擎都适用于那些场景？

- InnoDB：需要**事务支持**，有较高的并发读写频率
- MyISAM：对事务完整性没有要求，**读多写少**
- Memory：存储临时数据（一次性适用），对访问速度要求较快

## MySQL 都有哪些日志？

1. [[src/数据库/binlog\|binlog（二进制日志）	]]
	- 记录执行修改的所有操作，三种模式：ROW/STATMENT/MIXED
	- 作用：**恢复数据库和主从同步**
2. [[src/数据库/redo log\|redo log]]（重做日志）
	- InnoDB 特有，记录事务日志
	- [[src/数据库/redo log#什么是两阶段提交\|两阶段提交]]：写 binlog 成功后才会 commit
	- 作用：用于**数据恢复**，保证数据的完整性
3. [[src/数据库/undo log\|undo log]]（回滚日志）
	- 记录修改前的内容
	- 作用：**事务回滚**，回溯到某个特定的版本的数据

## binlog 和 redolog、undo log 有什么区别？

| 项目         | redolog  | binlog   |   undolog  | 
| ------------ | -------- | -------- | --- |
| **日志类型** | 物理日志 | 逻辑日志 |  逻辑日志   |
| **提供方**   | InnoDB   | MySQL    |  InnoDB   |
| **写入方式** | 循环写入 | 追加写入 |     |

- undo log记录数据旧版本，用于回滚和MVCC
- redo log记录数据修改的物理操作，用于崩溃恢复和数据持久化

## 主键使用自增 ID 和 UUID 的区别？

1. 自增 ID 更合适
2. UUID 的缺点
	- 无序的，插入数据时页数据会变化，导致「页分裂」，速度慢
		- InnoDB 中的主键是聚簇索引
		- 会把相邻主键的数据，存储在相邻的物理存储上（页）
	- 占用空间大，索引的空间大，读取数据 I/O 次数会更多