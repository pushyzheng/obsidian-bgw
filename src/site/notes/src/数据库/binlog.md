---
{"dg-publish":true,"dg-permalink":"binlog","permalink":"/binlog/"}
---


#数据库 #MySQL 

binlog 是归档的二进制日志，是 Server 层生成的日志，主要用于数据备份和主从复制。

## MySQL 的 binlog 是什么？

binlog 以**二进制**格式保存到磁盘中，是 MySQL 的**逻辑**日志，记录数据库操作的逻辑事件，而非物理数据页的变更。

主要功能：
1. ==记录内容==
	- 所有**修改**数据的SQL语句（不包括查询）
	- 包括事务的开始、提交和回滚信息，保证**事务安全性**
2. ==日志格式==
	- 支持三种格式
		- **STATEMENT**（基于语句）：记录 SQL 语句，日志量小，性能较好
		- **ROW**（基于行）：记录每行数据的**具体变更** （修改前后值），日志量大
		- **MIXED**（混合）：根据语句来选择上边两种
	- MySQL 5.7.7之后默认格式为 **ROW**
3. ==写入方式==
	- 以**追加**方式写入，文件大小可通过 max_binlog_size 参数控制
	- 达到大小后生成新文件

## binlog 的主要用途是什么？

- ==主从复制==
	- 主库将binlog传递给**从库**，实现数据同步和备份
- ==数据恢复==
	- 通过回放binlog中的操作，恢复误操作或宕机导致的数据丢失

## redo log 和 binlog 有什么区别？

- ==适用对象不同==
	- [[src/数据库/binlog\|binlog]]是 MySQL 的 **Server 层**实现的日志，所有引擎都可以使用
	- [[src/数据库/redo log\|redo log]]是 **Innodb 存储引擎**实现的日志
- ==文件格式不同==
	- binlog 是**逻辑**日志
	- [[src/数据库/redo log\|redo log]]是**物理**日志，记录的是某个数据页做了什么修改
- ==写入方式不同==
	- binlog 是**追加**写，写满一个后会重新创建新的文件写
	- [[src/数据库/redo log\|redo log]]是循环写，日志空间大小是**固定的**
- ==用途不同==
	- binlog 用于备份恢复、主从复制
	- redo log 用于掉电等故障恢复